<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Dashboard - Codedemia</title>
    <link rel="stylesheet" href="/style.css">
    <style>
        body { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; }
        .dashboard { padding: 20px; max-width: 1200px; margin: 0 auto; }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; background: white; padding: 20px; border-radius: 10px; }
        .languages { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin: 20px 0; }
        .language-btn { padding: 20px; background: white; border: 2px solid #667eea; border-radius: 10px; cursor: pointer; text-align: center; transition: all 0.3s; }
        .language-btn:hover, .language-btn.selected { background: #667eea; color: white; transform: translateY(-5px); }
        .tutor-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin: 20px 0; }
        .tutor-card { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .tutor-card h3 { color: #667eea; margin-bottom: 10px; }
        .btn { padding: 10px 20px; background: #667eea; color: white; border: none; border-radius: 5px; cursor: pointer; }
        .btn:hover { background: #764ba2; }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); justify-content: center; align-items: center; }
        .modal.active { display: flex; }
        .modal-content { background: white; padding: 30px; border-radius: 10px; max-width: 500px; width: 90%; max-height: 80vh; overflow-y: auto; }
        input, select, textarea { width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #ddd; border-radius: 5px; }
        .hidden { display: none; }
    </style>
</head>
<body>
    <div class="dashboard">
        <div class="header">
            <h1>üëã Welcome, <span id="userName">Student</span></h1>
            <button class="btn" onclick="logout()">Logout</button>
        </div>

        <h2>Select a Programming Language</h2>
        <div class="languages">
            <div class="language-btn" onclick="selectLanguage('HTML', 1)">üåê HTML</div>
            <div class="language-btn" onclick="selectLanguage('JavaScript', 2)">üü® JavaScript</div>
            <div class="language-btn" onclick="selectLanguage('Java', 3)">‚òï Java</div>
            <div class="language-btn" onclick="selectLanguage('Python', 4)">üêç Python</div>
            <div class="language-btn" onclick="selectLanguage('C++', 5)">‚ö° C++</div>
        </div>

        <div id="tutorSection" class="hidden">
            <h2>Available Tutors</h2>
            <div class="tutor-grid" id="tutorGrid"></div>
        </div>
    </div>

    <!-- Booking Modal -->
    <div id="bookingModal" class="modal">
        <div class="modal-content">
            <h2>Book a Session</h2>
            <form id="bookingForm">
                <input type="date" id="bookingDate" required>
                <input type="time" id="bookingTime" required>
                <select id="bookingDuration" required>
                    <option value="">Select Duration</option>
                    <option value="1">1 hour</option>
                    <option value="1.5">1.5 hours</option>
                    <option value="2">2 hours</option>
                    <option value="3">3 hours</option>
                </select>
                <select id="meetingType" required>
                    <option value="">Select Meeting Type</option>
                    <option value="online">üíª Online</option>
                    <option value="in-person">üè¢ In-Person</option>
                    <option value="hybrid">üîÑ Hybrid</option>
                </select>
                <input type="text" id="location" placeholder="Location (for in-person)">
                <input type="text" id="platform" placeholder="Platform (Zoom, Meet, etc.)">
                <textarea id="notes" placeholder="What do you want to learn?" rows="4"></textarea>
                <button type="submit" class="btn">Confirm Booking</button>
                <button type="button" class="btn" onclick="closeModal()" style="background: #dc3545; margin-left: 10px;">Cancel</button>
            </form>
        </div>
    </div>

    <script>
        let selectedLanguage = '';
        let selectedTutorId = null;
        const tutorData = {
            'HTML': { id: 1, name: 'Sarah Johnson', price: '‚Ç±250/hr', bio: 'HTML/CSS expert specializing in semantic markup.' },
            'JavaScript': { id: 2, name: 'Alex Thompson', price: '‚Ç±300/hr', bio: 'Full-stack JavaScript expert with React experience.' },
            'Java': { id: 3, name: 'Robert Singh', price: '‚Ç±280/hr', bio: 'Senior Java architect specializing in enterprise apps.' },
            'Python': { id: 4, name: 'Emily Rodriguez', price: '‚Ç±290/hr', bio: 'Python expert with focus on web development and data science.' },
            'C++': { id: 5, name: 'Andrew Miller', price: '‚Ç±310/hr', bio: 'Systems programming expert with deep C++ knowledge.' }
        };

        // Check auth
        window.addEventListener('DOMContentLoaded', async () => {
            const token = localStorage.getItem('token');
            const user = JSON.parse(localStorage.getItem('user') || '{}');
            
            if (!token || user.role !== 'student') {
                window.location.href = '/';
                return;
            }
            
            document.getElementById('userName').textContent = user.name;
        });

        function selectLanguage(lang, tutorId) {
            selectedLanguage = lang;
            document.querySelectorAll('.language-btn').forEach(btn => btn.classList.remove('selected'));
            event.target.classList.add('selected');
            
            const tutor = tutorData[lang];
            document.getElementById('tutorSection').classList.remove('hidden');
            document.getElementById('tutorGrid').innerHTML = `
                <div class="tutor-card">
                    <h3>${tutor.name}</h3>
                    <p><strong>Price:</strong> ${tutor.price}</p>
                    <p>${tutor.bio}</p>
                    <button class="btn" onclick="openBookingModal(${tutor.id})">Book Session</button>
                </div>
            `;
        }

        function openBookingModal(tutorId) {
            selectedTutorId = tutorId;
            document.getElementById('bookingModal').classList.add('active');
            
            // Set min date to today
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('bookingDate').min = today;
        }

        function closeModal() {
            document.getElementById('bookingModal').classList.remove('active');
            document.getElementById('bookingForm').reset();
        }

        document.getElementById('bookingForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const token = localStorage.getItem('token');
            const bookingData = {
                tutor_id: selectedTutorId,
                language: selectedLanguage,
                date: document.getElementById('bookingDate').value,
                time: document.getElementById('bookingTime').value,
                duration: parseFloat(document.getElementById('bookingDuration').value),
                meeting_type: document.getElementById('meetingType').value,
                location: document.getElementById('location').value,
                platform: document.getElementById('platform').value,
                notes: document.getElementById('notes').value
            };
            
            try {
                const res = await fetch('/api/bookings/create', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify(bookingData)
                });
                
                const data = await res.json();
                
                if (data.success) {
                    alert('‚úÖ Booking created successfully! The professor will review your request.');
                    closeModal();
                } else {
                    alert('‚ùå Booking failed: ' + data.message);
                }
            } catch (err) {
                alert('‚ùå Error creating booking. Please try again.');
            }
        });

        function logout() {
            localStorage.removeItem('token');
            localStorage.removeItem('user');
            window.location.href = '/';
        }
    </script>
</body>
</html>